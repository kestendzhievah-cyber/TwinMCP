// ─── Conversation & Messaging Models ─────────────────────────────

model Conversation {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  title     String
  metadata  Json     @default("{}")
  settings  Json     @default("{}")
  analytics Json     @default("{}")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages Message[]
  shares   ConversationShare[]
  exports  ConversationExport[]
  
  @@map("conversations")
}

model Message {
  id             String   @id @default(cuid())
  conversationId String   @map("conversation_id")
  role           String
  content        String
  timestamp      DateTime @default(now())
  metadata       Json     @default("{}")
  
  conversation   Conversation       @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  reactions      MessageReaction[]
  attachments    MessageAttachment[]
  
  @@map("messages")
}

model MessageReaction {
  id        String   @id @default(cuid())
  messageId String   @map("message_id")
  userId    String   @map("user_id")
  emoji     String
  timestamp DateTime @default(now())
  
  message   Message @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([messageId, userId, emoji])
  @@map("message_reactions")
}

model MessageAttachment {
  id        String  @id @default(cuid())
  messageId String  @map("message_id")
  type      String
  name      String
  url       String
  size      BigInt?
  mimeType  String? @map("mime_type")
  metadata  Json    @default("{}")
  thumbnail String?
  
  message   Message @relation(fields: [messageId], references: [id], onDelete: Cascade)
  
  @@map("message_attachments")
}

model ConversationShare {
  id           String    @id @default(cuid())
  conversationId String   @map("conversation_id")
  shareId      String    @unique @map("share_id")
  createdBy    String    @map("created_by")
  createdAt    DateTime  @default(now()) @map("created_at")
  expiresAt    DateTime? @map("expires_at")
  permissions  Json      @default("{}")
  settings     Json      @default("{}")
  analytics    Json      @default("{}")
  
  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  creator      User        @relation(fields: [createdBy], references: [id], onDelete: Cascade)
  
  @@map("conversation_shares")
}

model ConversationExport {
  id            String    @id @default(cuid())
  conversationId String    @map("conversation_id")
  format        String
  options       Json      @default("{}")
  status        String    @default("pending")
  downloadUrl   String?   @map("download_url")
  expiresAt     DateTime? @map("expires_at")
  createdAt     DateTime  @default(now()) @map("created_at")
  completedAt   DateTime? @map("completed_at")
  error         String?
  
  conversation  Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  
  @@map("conversation_exports")
}
